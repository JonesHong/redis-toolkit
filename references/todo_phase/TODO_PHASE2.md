# ASR_Hub ç¬¬äºŒéšæ®µå·¥ä½œæ¸…å–®

## ğŸ“‹ éšæ®µç›®æ¨™
å¯¦ä½œæ‰€æœ‰åŸºç¤é¡åˆ¥ï¼Œå»ºç«‹æ ¸å¿ƒåŠŸèƒ½æ¡†æ¶ï¼Œå„ªå…ˆå¯¦ä½œ HTTP SSE APIã€sample_rate operator å’Œ local whisper providerã€‚

## âœ… å·¥ä½œé …ç›®æ¸…å–®

### 1. å¯¦ä½œæ‰€æœ‰åŸºç¤é¡åˆ¥ï¼ˆBase Classesï¼‰

#### 1.1 API åŸºç¤é¡åˆ¥ï¼ˆsrc/api/base.pyï¼‰
- [x] 1.1.1 å®šç¾© APIBase æŠ½è±¡é¡åˆ¥
  - å®šç¾©çµ±ä¸€çš„æ§åˆ¶æŒ‡ä»¤ä»‹é¢ï¼ˆstartã€stopã€statusã€busy_startã€busy_endï¼‰
  - å®šç¾© transcribe å’Œ transcribe_stream æŠ½è±¡æ–¹æ³•
  - å¯¦ä½œå…±ç”¨çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
  - å¯¦ä½œå…±ç”¨çš„ session ç®¡ç†ä»‹é¢
- [x] 1.1.2 å®šç¾© APIResponse è³‡æ–™æ¨¡å‹
  - çµ±ä¸€çš„å›æ‡‰æ ¼å¼ï¼ˆstatusã€dataã€errorã€session_idï¼‰
  - æ”¯æ´ä¸²æµå›æ‡‰çš„è³‡æ–™çµæ§‹
- [x] 1.1.3 å¯¦ä½œåŸºç¤çš„è«‹æ±‚é©—è­‰å’Œåƒæ•¸è™•ç†
  - éŸ³è¨Šæ ¼å¼é©—è­‰ï¼ˆsample_rateã€channelsã€formatï¼‰
  - Pipeline é…ç½®é©—è­‰

#### 1.2 Pipeline åŸºç¤é¡åˆ¥ï¼ˆsrc/pipeline/base.pyï¼‰
- [x] 1.2.1 å®šç¾© PipelineBase æŠ½è±¡é¡åˆ¥
  - å¯¦ä½œ RxJS é¢¨æ ¼çš„ä¸²æµè™•ç†ä»‹é¢
  - å®šç¾© process å’Œ process_stream æ–¹æ³•
  - å¯¦ä½œ operator chain ç®¡ç†
- [x] 1.2.2 å¯¦ä½œ Pipeline ç”Ÿå‘½é€±æœŸç®¡ç†
  - initializeã€startã€stopã€cleanup æ–¹æ³•
  - è³‡æºç®¡ç†å’Œé‡‹æ”¾æ©Ÿåˆ¶
- [x] 1.2.3 å»ºç«‹ Pipeline é…ç½®ä»‹é¢
  - operators åˆ—è¡¨ç®¡ç†
  - å‹•æ…‹è¼‰å…¥å’Œé…ç½® operators

#### 1.3 Operator åŸºç¤é¡åˆ¥ï¼ˆsrc/pipeline/operators/base.pyï¼‰
- [x] 1.3.1 å®šç¾© OperatorBase æŠ½è±¡é¡åˆ¥
  - å®šç¾© process å’Œ process_stream ä»‹é¢
  - è¼¸å…¥/è¼¸å‡ºæ ¼å¼å®šç¾©ï¼ˆAudioChunk è³‡æ–™æ¨¡å‹ï¼‰
  - å¯¦ä½œä¸²æµè™•ç†çš„åŸºç¤é‚è¼¯
- [x] 1.3.2 å¯¦ä½œ Operator é…ç½®ç®¡ç†
  - åƒæ•¸é©—è­‰æ©Ÿåˆ¶
  - é è¨­å€¼è™•ç†
  - å‹åˆ¥æª¢æŸ¥
- [x] 1.3.3 å»ºç«‹ Operator éˆæ¥æ©Ÿåˆ¶
  - next() å’Œ subscribe() æ–¹æ³•
  - éŒ¯èª¤å‚³æ’­æ©Ÿåˆ¶

#### 1.4 Provider åŸºç¤é¡åˆ¥ï¼ˆsrc/providers/base.pyï¼‰
- [x] 1.4.1 å®šç¾© ProviderBase æŠ½è±¡é¡åˆ¥
  - å®šç¾© transcribe å’Œ transcribe_stream ä»‹é¢
  - çµ±ä¸€çš„è¼¸å…¥/è¼¸å‡ºæ ¼å¼ï¼ˆTranscriptResult è³‡æ–™æ¨¡å‹ï¼‰
  - èªè¨€å’Œæ¨¡å‹é…ç½®ä»‹é¢
- [x] 1.4.2 å¯¦ä½œ Provider ç”Ÿå‘½é€±æœŸç®¡ç†
  - æ¨¡å‹è¼‰å…¥å’Œåˆå§‹åŒ–
  - è³‡æºç®¡ç†ï¼ˆGPU/è¨˜æ†¶é«”ï¼‰
  - æ¸…ç†å’Œé‡‹æ”¾æ©Ÿåˆ¶
- [x] 1.4.3 å»ºç«‹ Provider éŒ¯èª¤è™•ç†
  - çµ±ä¸€çš„ç•°å¸¸é¡å‹
  - é‡è©¦æ©Ÿåˆ¶
  - Fallback è™•ç†

### 2. å¯¦ä½œè³‡æ–™æ¨¡å‹ï¼ˆsrc/models/ï¼‰

#### 2.1 éŸ³è¨Šè³‡æ–™æ¨¡å‹ï¼ˆsrc/models/audio.pyï¼‰
- [x] 2.1.1 å®šç¾© AudioChunk é¡åˆ¥
  - éŸ³è¨Šè³‡æ–™ï¼ˆbytesï¼‰
  - å–æ¨£ç‡ã€é€šé“æ•¸ã€æ ¼å¼
  - æ™‚é–“æˆ³è¨˜è³‡è¨Š
- [x] 2.1.2 å®šç¾© AudioFormat åˆ—èˆ‰
  - æ”¯æ´çš„éŸ³è¨Šæ ¼å¼ï¼ˆPCMã€WAVã€MP3 ç­‰ï¼‰
  - æ ¼å¼è½‰æ›ä»‹é¢

#### 2.2 è½‰è­¯çµæœæ¨¡å‹ï¼ˆsrc/models/transcript.pyï¼‰
- [x] 2.2.1 å®šç¾© TranscriptResult é¡åˆ¥
  - è½‰è­¯æ–‡å­—ï¼ˆtextï¼‰
  - æ™‚é–“æˆ³è¨˜ï¼ˆstart_timeã€end_timeï¼‰
  - ä¿¡å¿ƒåˆ†æ•¸ï¼ˆconfidenceï¼‰
  - èªè¨€è³‡è¨Š
- [x] 2.2.2 å®šç¾© TranscriptSegment é¡åˆ¥
  - ç”¨æ–¼ä¸²æµçµæœçš„ç‰‡æ®µ
  - is_final æ¨™è¨˜
  - æ›¿ä»£çµæœåˆ—è¡¨

#### 2.3 Session æ¨¡å‹ï¼ˆsrc/models/session.pyï¼‰
- [x] 2.3.1 å®šç¾© Session é¡åˆ¥
  - session_idï¼ˆUUIDï¼‰
  - ç‹€æ…‹ï¼ˆIDLEã€LISTENINGã€BUSYï¼‰
  - å»ºç«‹æ™‚é–“ã€æœ€å¾Œæ´»å‹•æ™‚é–“
  - Pipeline é…ç½®
  - Provider é…ç½®

### 3. å¯¦ä½œ HTTP SSE Serverï¼ˆå„ªå…ˆï¼‰

#### 3.1 HTTP SSE åŸºç¤æ¶æ§‹ï¼ˆsrc/api/http_sse/ï¼‰
- [x] 3.1.1 å»ºç«‹ SSEServer é¡åˆ¥ï¼ˆç¹¼æ‰¿ APIBaseï¼‰
  - ä½¿ç”¨ FastAPI æˆ– aiohttp å¯¦ä½œ
  - å¯¦ä½œ SSE é€£ç·šç®¡ç†
  - å¯¦ä½œå¿ƒè·³æ©Ÿåˆ¶ï¼ˆkeep-aliveï¼‰
- [x] 3.1.2 å¯¦ä½œ SSE äº‹ä»¶æ ¼å¼
  - å®šç¾©äº‹ä»¶é¡å‹ï¼ˆcontrolã€transcriptã€errorã€statusï¼‰
  - å¯¦ä½œäº‹ä»¶åºåˆ—åŒ–
  - æ”¯æ´ JSON æ ¼å¼è³‡æ–™

#### 3.2 æ§åˆ¶æŒ‡ä»¤è™•ç†ï¼ˆsrc/api/http_sse/handlers.pyï¼‰
- [x] 3.2.1 å¯¦ä½œ /control endpoint
  - POST æ–¹æ³•æ¥æ”¶æ§åˆ¶æŒ‡ä»¤
  - è™•ç† startã€stopã€statusã€busy_startã€busy_end
  - å›å‚³æŒ‡ä»¤åŸ·è¡Œçµæœ
- [x] 3.2.2 å¯¦ä½œ session ç®¡ç†
  - å»ºç«‹æ–° session
  - æŸ¥è©¢ session ç‹€æ…‹
  - æ¸…ç†éæœŸ session

#### 3.3 éŸ³è¨Šä¸²æµè™•ç†
- [x] 3.3.1 å¯¦ä½œ /transcribe endpointï¼ˆSSEï¼‰
  - å»ºç«‹ SSE é€£ç·š
  - æ¥æ”¶éŸ³è¨Šè³‡æ–™ï¼ˆé€éå¦ä¸€å€‹ endpoint æˆ– WebSocketï¼‰
  - ä¸²æµå›å‚³è½‰è­¯çµæœ
- [x] 3.3.2 å¯¦ä½œéŸ³è¨Šä¸Šå‚³ endpoint
  - POST /audio/upload æ¥æ”¶éŸ³è¨Š chunks
  - æ”¯æ´ multipart/form-data
  - é©—è­‰éŸ³è¨Šæ ¼å¼

### 4. å¯¦ä½œ Sample Rate Operatorï¼ˆå„ªå…ˆï¼‰

#### 4.1 Sample Rate Adjustment Operatorï¼ˆsrc/pipeline/operators/sample_rate.pyï¼‰
- [x] 4.1.1 å»ºç«‹ SampleRateOperator é¡åˆ¥ï¼ˆç¹¼æ‰¿ OperatorBaseï¼‰
  - å¯¦ä½œå–æ¨£ç‡è½‰æ›æ¼”ç®—æ³•
  - æ”¯æ´å¸¸è¦‹å–æ¨£ç‡ï¼ˆ8000ã€16000ã€44100ã€48000 Hzï¼‰
  - ä½¿ç”¨ scipy æˆ– librosa é€²è¡Œé‡æ–°å–æ¨£
- [x] 4.1.2 å¯¦ä½œä¸²æµè™•ç†
  - è™•ç†ä¸å®Œæ•´çš„éŸ³è¨Š chunks
  - ç¶­è­·å…§éƒ¨ç·©è¡å€
  - ç¢ºä¿éŸ³è¨Šé€£çºŒæ€§
- [x] 4.1.3 æ•ˆèƒ½å„ªåŒ–
  - å¯¦ä½œå¿«å–æ©Ÿåˆ¶ï¼ˆç›¸åŒè½‰æ›åƒæ•¸ï¼‰
  - æ”¯æ´æ‰¹æ¬¡è™•ç†
  - å¤šåŸ·è¡Œç·’/ç•°æ­¥è™•ç†

### 5. å¯¦ä½œ Local Whisper Providerï¼ˆå„ªå…ˆï¼‰

#### 5.1 Whisper Provider åŸºç¤ï¼ˆsrc/providers/whisper/provider.pyï¼‰
- [x] 5.1.1 å»ºç«‹ WhisperProvider é¡åˆ¥ï¼ˆç¹¼æ‰¿ ProviderBaseï¼‰
  - æ•´åˆ OpenAI Whisper æˆ– faster-whisper
  - å¯¦ä½œæ¨¡å‹è¼‰å…¥ï¼ˆæ”¯æ´ä¸åŒå¤§å°ï¼štinyã€baseã€smallã€mediumã€largeï¼‰
  - é…ç½® GPU/CPU åŸ·è¡Œ
- [x] 5.1.2 å¯¦ä½œæ‰¹æ¬¡è½‰è­¯
  - transcribe æ–¹æ³•ï¼ˆå®Œæ•´éŸ³è¨Šï¼‰
  - èªè¨€åµæ¸¬æˆ–æŒ‡å®šèªè¨€
  - å›å‚³ TranscriptResult

#### 5.2 ä¸²æµè½‰è­¯å¯¦ä½œ
- [x] 5.2.1 å¯¦ä½œ transcribe_stream æ–¹æ³•
  - è™•ç†å³æ™‚éŸ³è¨Šä¸²æµ
  - å¯¦ä½œæ»‘å‹•è¦–çª—æ©Ÿåˆ¶
  - ç®¡ç†å…§éƒ¨éŸ³è¨Šç·©è¡å€
- [x] 5.2.2 å„ªåŒ–ä¸²æµæ•ˆèƒ½
  - VAD æ•´åˆï¼ˆåªè™•ç†æœ‰èªéŸ³çš„éƒ¨åˆ†ï¼‰
  - å‹•æ…‹èª¿æ•´è¦–çª—å¤§å°
  - å¯¦ä½œéƒ¨åˆ†çµæœå¿«å–

#### 5.3 Whisper ç‰¹å®šåŠŸèƒ½
- [x] 5.3.1 å¯¦ä½œé€²éšåŠŸèƒ½
  - æ™‚é–“æˆ³è¨˜å°é½Š
  - å­—è©ç´šåˆ¥æ™‚é–“æˆ³è¨˜ï¼ˆå¦‚æœæ¨¡å‹æ”¯æ´ï¼‰
  - èªè¨€æ©Ÿç‡è¼¸å‡º
- [x] 5.3.2 éŒ¯èª¤è™•ç†å’Œæ¢å¾©
  - è¨˜æ†¶é«”ä¸è¶³è™•ç†
  - æ¨¡å‹è¼‰å…¥å¤±æ•—è™•ç†
  - è‡ªå‹•é™ç´šåˆ°è¼ƒå°æ¨¡å‹

### 6. æ ¸å¿ƒæ¨¡çµ„æ•´åˆï¼ˆsrc/core/ï¼‰

#### 6.1 ASRHub ä¸»é¡åˆ¥å®Œå–„ï¼ˆsrc/core/asr_hub.pyï¼‰
- [x] 6.1.1 æ•´åˆæ‰€æœ‰æ¨¡çµ„
  - åˆå§‹åŒ– API servers
  - åˆå§‹åŒ– Pipeline manager
  - åˆå§‹åŒ– Provider manager
- [x] 6.1.2 å¯¦ä½œä¸»è¦æµç¨‹
  - æ¥æ”¶è«‹æ±‚ â†’ Pipeline è™•ç† â†’ Provider è½‰è­¯ â†’ å›å‚³çµæœ
  - éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
  - æ•ˆèƒ½ç›£æ§

#### 6.2 Session Manager å¯¦ä½œï¼ˆsrc/core/session_manager.pyï¼‰
- [x] 6.2.1 å¯¦ä½œ SessionManager é¡åˆ¥
  - å»ºç«‹ã€æŸ¥è©¢ã€æ›´æ–°ã€åˆªé™¤ session
  - Session éæœŸç®¡ç†
  - ä¸¦ç™¼ session é™åˆ¶
- [x] 6.2.2 Session ç‹€æ…‹åŒæ­¥
  - è·¨ API å”å®šçš„ session å…±äº«
  - ç‹€æ…‹è®Šæ›´é€šçŸ¥æ©Ÿåˆ¶

#### 6.3 æœ‰é™ç‹€æ…‹æ©Ÿå¯¦ä½œï¼ˆsrc/core/fsm.pyï¼‰
- [x] 6.3.1 å¯¦ä½œ FSM é¡åˆ¥
  - å®šç¾©ç‹€æ…‹ï¼ˆIDLEã€LISTENINGã€BUSYï¼‰
  - å®šç¾©ç‹€æ…‹è½‰æ›è¦å‰‡
  - å¯¦ä½œç‹€æ…‹è½‰æ›æ–¹æ³•
- [x] 6.3.2 ç‹€æ…‹ç®¡ç†
  - ç‹€æ…‹æŒä¹…åŒ–
  - ç‹€æ…‹è®Šæ›´å›èª¿
  - ä¸¦ç™¼ç‹€æ…‹ç®¡ç†

### 7. ä¸²æµè™•ç†æ¨¡çµ„ï¼ˆsrc/stream/ï¼‰

#### 7.1 éŸ³è¨Šä¸²æµè™•ç†ï¼ˆsrc/stream/audio_stream.pyï¼‰
- [x] 7.1.1 å¯¦ä½œ AudioStream é¡åˆ¥
  - æ¥æ”¶éŸ³è¨Šè³‡æ–™
  - ç®¡ç†ä¸²æµç”Ÿå‘½é€±æœŸ
  - å¯¦ä½œèƒŒå£“ï¼ˆbackpressureï¼‰è™•ç†
- [x] 7.1.2 ä¸²æµåˆ†ç™¼
  - åˆ†ç™¼åˆ°å¤šå€‹ operators
  - æ”¯æ´å¤šå€‹è¨‚é–±è€…

#### 7.2 Buffer ç®¡ç†ï¼ˆsrc/stream/buffer_manager.pyï¼‰
- [x] 7.2.1 å¯¦ä½œ BufferManager é¡åˆ¥
  - ç’°å½¢ç·©è¡å€å¯¦ä½œ
  - æº¢å‡ºè™•ç†ç­–ç•¥
  - è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
- [x] 7.2.2 ç·©è¡å€æ“ä½œ
  - å¯«å…¥ã€è®€å–ã€æ¸…ç©º
  - ä¸¦ç™¼å®‰å…¨æ“ä½œ
  - æ•ˆèƒ½å„ªåŒ–

### 8. Manager é¡åˆ¥å¯¦ä½œ

#### 8.1 Pipeline Managerï¼ˆsrc/pipeline/manager.pyï¼‰
- [x] 8.1.1 å¯¦ä½œ PipelineManager é¡åˆ¥
  - Pipeline å¯¦ä¾‹ç®¡ç†
  - å‹•æ…‹å‰µå»ºå’Œé…ç½® pipeline
  - Pipeline é©—è­‰
- [x] 8.1.2 Operator è¨»å†Šæ©Ÿåˆ¶
  - è¨»å†Šå¯ç”¨çš„ operators
  - å‹•æ…‹è¼‰å…¥ operator

#### 8.2 Provider Managerï¼ˆsrc/providers/manager.pyï¼‰
- [x] 8.2.1 å¯¦ä½œ ProviderManager é¡åˆ¥
  - Provider å¯¦ä¾‹ç®¡ç†
  - è² è¼‰å¹³è¡¡ï¼ˆå¦‚æœæœ‰å¤šå€‹ providerï¼‰
  - Provider å¥åº·æª¢æŸ¥
- [x] 8.2.2 Provider è·¯ç”±
  - æ ¹æ“šèªè¨€é¸æ“‡ provider
  - Fallback æ©Ÿåˆ¶
  - å„ªå…ˆç´šç®¡ç†

### 9. å·¥å…·å‡½å¼å¯¦ä½œï¼ˆsrc/utils/ï¼‰

#### 9.1 éŸ³è¨Šè™•ç†å·¥å…·ï¼ˆsrc/utils/audio_utils.pyï¼‰
- [x] 9.1.1 å¯¦ä½œéŸ³è¨Šæ ¼å¼è½‰æ›
  - PCM â†” WAV è½‰æ›
  - æ¡æ¨£ç‡è½‰æ›å‡½å¼
  - é€šé“æ•¸è½‰æ›
- [x] 9.1.2 éŸ³è¨Šåˆ†æå·¥å…·
  - è¨ˆç®—éŸ³é‡ï¼ˆRMSï¼‰
  - éœéŸ³åµæ¸¬
  - éŸ³è¨Šé•·åº¦è¨ˆç®—

#### 9.2 é©—è­‰å·¥å…·ï¼ˆsrc/utils/validators.pyï¼‰
- [x] 9.2.1 å¯¦ä½œé…ç½®é©—è­‰
  - Pipeline é…ç½®é©—è­‰
  - Provider é…ç½®é©—è­‰
  - API åƒæ•¸é©—è­‰
- [x] 9.2.2 éŸ³è¨Šæ ¼å¼é©—è­‰
  - æ”¯æ´æ ¼å¼æª¢æŸ¥
  - åƒæ•¸ç¯„åœæª¢æŸ¥

### 10. ä¾‹å¤–è™•ç†å®Œå–„ï¼ˆsrc/core/exceptions.pyï¼‰
- [x] 10.1 å®šç¾©è‡ªå®šç¾©ä¾‹å¤–é¡åˆ¥
  - ASRHubExceptionï¼ˆåŸºç¤é¡åˆ¥ï¼‰
  - ConfigurationError
  - PipelineError
  - ProviderError
  - StreamError
  - SessionError
- [x] 10.2 ä¾‹å¤–è™•ç†æ©Ÿåˆ¶
  - çµ±ä¸€çš„éŒ¯èª¤è¨Šæ¯æ ¼å¼
  - éŒ¯èª¤ç¢¼å®šç¾©
  - éŒ¯èª¤è¿½è¹¤å’Œæ—¥èªŒ

## ğŸ” é©—æ”¶æ¨™æº–
1. âœ… æ‰€æœ‰åŸºç¤é¡åˆ¥éƒ½å·²å¯¦ä½œä¸”éµå¾ª SOLID åŸå‰‡
2. âœ… HTTP SSE server å¯ä»¥æ¥æ”¶æ§åˆ¶æŒ‡ä»¤ä¸¦å›æ‡‰
3. âœ… Sample rate operator å¯ä»¥æ­£ç¢ºè½‰æ›éŸ³è¨Šå–æ¨£ç‡
4. âœ… Local Whisper provider å¯ä»¥é€²è¡ŒåŸºæœ¬çš„èªéŸ³è½‰æ–‡å­—
5. âœ… æ•´é«”ç³»çµ±å¯ä»¥å®Œæˆï¼šæ¥æ”¶éŸ³è¨Š â†’ Pipeline è™•ç† â†’ Whisper è½‰è­¯ â†’ å›å‚³çµæœçš„å®Œæ•´æµç¨‹
6. âœ… æ‰€æœ‰æ¨¡çµ„éƒ½æœ‰é©ç•¶çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„

## ğŸ“ æ³¨æ„äº‹é …
1. å°ˆæ³¨æ–¼æ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…éåº¦è¨­è¨ˆ
2. ä½¿ç”¨ pretty-loguru è¨˜éŒ„æ‰€æœ‰é‡è¦æ“ä½œ
3. ç¢ºä¿æ‰€æœ‰é¡åˆ¥éƒ½æœ‰å®Œæ•´çš„ docstring
4. éµå¾ª Python å‹åˆ¥æç¤ºï¼ˆtypingï¼‰
5. ä¿æŒç¨‹å¼ç¢¼ç°¡æ½”ï¼Œéµå¾ª KISS åŸå‰‡
6. ä¸å¯¦ä½œæ¸¬è©¦ã€æ–‡ä»¶å’Œéƒ¨ç½²ç›¸é—œå…§å®¹



---
å»ºç«‹æ™‚é–“ï¼š2025-07-24
æœ€å¾Œæ›´æ–°ï¼š2025-07-24
è² è²¬äººï¼šASR Hub Team